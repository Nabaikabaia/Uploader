<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nãbēēs Secure File Uploader</title>
    <meta name="description" content="Secure file uploads | Nãbēēs Tech">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: "#3B82F6",
                        dark: "#0F172A",
                        accent: "#10B981",
                        nabees: "#8B5CF6"
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'text-gradient': 'text-gradient 4s linear infinite',
                        'fade-in': 'fadeIn 1s ease-out forwards',
                        'fade-out': 'fadeOut 1s ease-out forwards',
                        'scale-in': 'scaleIn 0.8s ease-out forwards',
                        'scale-out': 'scaleOut 0.8s ease-out forwards',
                        'bounce': 'bounce 2s infinite',
                        'orbit': 'orbit 4s linear infinite',
                        'orbit-reverse': 'orbitReverse 4s linear infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' }
                        },
                        glow: {
                            '0%': { 'box-shadow': '0 0 5px #8B5CF6' },
                            '100%': { 'box-shadow': '0 0 20px #8B5CF6' }
                        },
                        'text-gradient': {
                            '0%, 100%': { 'background-position': '0% 50%' },
                            '50%': { 'background-position': '100% 50%' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        scaleOut: {
                            '0%': { transform: 'scale(1)', opacity: '1' },
                            '100%': { transform: 'scale(0.95)', opacity: '0' }
                        },
                        bounce: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        orbit: {
                            '0%': { transform: 'rotate(0deg) translateX(20px) rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg) translateX(20px) rotate(-360deg)' }
                        },
                        orbitReverse: {
                            '0%': { transform: 'rotate(0deg) translateX(30px) rotate(0deg)' },
                            '100%': { transform: 'rotate(-360deg) translateX(30px) rotate(360deg)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .tech-grid {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(139, 92, 246, 0.2) 0%, transparent 50%);
        }
        .card-glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark .card-glass {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .gradient-text {
            background-image: linear-gradient(90deg, #8B5CF6, #3B82F6, #10B981);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: text-gradient 4s linear infinite;
        }
        .hexagon {
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }
        #previewImage {
            max-height: 200px;
            object-fit: contain;
        }
        .theme-toggle {
            transition: all 0.3s ease;
        }
        #initializationScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            transition: opacity 1s ease-out;
        }
        .page-transition {
            opacity: 0;
            transition: opacity 1s ease-out;
        }
        #mainContent {
            transition: opacity 1s ease-out;
        }
        .init-message {
            animation: fade-in 1s ease-out 0.5s both;
        }
        .init-logo {
            animation: fade-in 1s ease-out, float 6s ease-in-out infinite 1s;
        }
        .security-badge {
            animation: fade-in 1s ease-out 1.5s both;
        }
        .stagger-delay-1 { animation-delay: 0.2s; }
        .stagger-delay-2 { animation-delay: 0.4s; }
        .stagger-delay-3 { animation-delay: 0.6s; }
        #resultLink {
            word-break: break-all;
        }
        .copy-btn {
            transition: all 0.2s ease;
        }
        .copy-btn:hover {
            transform: scale(1.05);
        }
        .copy-btn:active {
            transform: scale(0.95);
        }
        .copy-success {
            background-color: #10B981 !important;
        }
        .satellite {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #8B5CF6;
        }
        .init-progress {
            width: 100%;
            max-width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin: 20px 0;
            overflow: hidden;
        }
        .init-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8B5CF6, #3B82F6);
            border-radius: 2px;
            transition: width 0.5s ease;
            width: 0%;
        }
        .message-container {
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 100%;
        }
        .init-message-text {
            position: absolute;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            text-align: center;
            width: 100%;
        }
        .init-message-text.active {
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen font-sans overflow-x-hidden bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">
    <!-- Initialization Screen -->
    <div id="initializationScreen" class="opacity-100">
        <div class="flex flex-col items-center justify-center space-y-6 px-4 text-center">
            <div class="relative w-24 h-24 mb-6">
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="w-16 h-16 rounded-full border-4 border-nabees border-opacity-30"></div>
                </div>
                <div class="satellite animate-orbit" style="top: 50%; left: 50%; margin-top: -4px; margin-left: -4px;"></div>
                <div class="satellite animate-orbit-reverse" style="top: 50%; left: 50%; margin-top: -4px; margin-left: -4px; background-color: #3B82F6;"></div>
            </div>
            
            <h1 class="text-3xl font-bold gradient-text init-message">
                Initializing Secure Uploader
            </h1>
            
            <div class="init-progress">
                <div id="initProgressBar" class="init-progress-bar"></div>
            </div>
            
            <div class="message-container">
                <p id="initMessage1" class="text-gray-300 init-message-text active">
                    Loading security protocols...
                </p>
                <p id="initMessage2" class="text-gray-300 init-message-text">
                    Connecting to Nãbēēs Secure Servers...
                </p>
                <p id="initMessage3" class="text-gray-300 init-message-text">
                    Verifying encryption channels...
                </p>
                <p id="initMessage4" class="text-gray-300 init-message-text">
                    Finalizing secure environment...
                </p>
            </div>
            
            <div class="text-xs text-gray-400 security-badge">
                <i class="fas fa-lock mr-1"></i> End-to-end encrypted transfers
            </div>
        </div>
    </div>

    <!-- Main Content (initially hidden) -->
    <div id="mainContent" class="hidden page-transition">
        <div class="tech-grid min-h-screen">
            <!-- Animated background elements -->
            <div class="fixed top-0 left-0 w-full h-full overflow-hidden z-0">
                <div class="absolute top-20 left-10 w-4 h-4 rounded-full bg-blue-500 animate-pulse-slow dark:bg-blue-400"></div>
                <div class="absolute top-1/3 right-20 w-6 h-6 hexagon bg-nabees animate-float"></div>
                <div class="absolute bottom-1/4 left-1/4 w-8 h-8 rounded-full bg-purple-500 animate-pulse-slow delay-1000 dark:bg-purple-400"></div>
                <div class="absolute bottom-20 right-1/3 w-5 h-5 hexagon bg-accent animate-float delay-1500"></div>
            </div>

            <header class="relative z-10">
                <nav class="container mx-auto px-6 py-6 flex justify-between items-center">
                    <div class="flex items-center space-x-2">
                        <div class="hexagon bg-nabees w-10 h-10 flex items-center justify-center dark:bg-purple-600">
                            <i class="fas fa-cloud-upload-alt text-white"></i>
                        </div>
                        <span class="text-2xl font-bold gradient-text">Nãbēēs Uploader</span>
                        <span class="text-sm bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full">Secure</span>
                    </div>
                    <button id="themeToggle" class="theme-toggle p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                </nav>
            </header>

            <main class="relative z-10">
                <section class="container mx-auto px-6 py-12 md:py-16">
                    <div class="max-w-3xl mx-auto card-glass rounded-xl p-6 md:p-8 shadow-lg animate-scale-in">
                        <h1 class="text-3xl md:text-4xl font-bold mb-6 text-center gradient-text">
                            Secure File Uploader
                        </h1>
                        <p class="text-center mb-8 text-gray-600 dark:text-gray-300">
                            Upload files anonymously and get custom short links. Files are stored in Nãbēēs Secure Servers.
                        </p>
                        
                        <form id="uploadForm" class="space-y-6">
                            <div class="space-y-2 stagger-delay-1">
                                <label for="fileUpload" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Select File</label>
                                <div class="flex items-center space-x-4">
                                    <label for="fileUpload" class="cursor-pointer bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-4 py-2 rounded-lg transition-colors w-full">
                                        <i class="fas fa-file-upload mr-2"></i>
                                        <span id="fileName">Choose a file to upload</span>
                                        <input id="fileUpload" type="file" class="hidden">
                                    </label>
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    Max file size: 20MB
                                </div>
                            </div>
                            
                            <div class="space-y-2 stagger-delay-2">
                                <label for="customName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Custom Link Name (Optional)</label>
                                <div class="flex">
                                    <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-300 text-sm">
                                        Filename/
                                    </span>
                                    <input type="text" id="customName" class="flex-1 rounded-none rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 focus:ring-2 focus:ring-nabees focus:border-transparent" placeholder="my-file">
                                </div>
                            </div>
                            
                            <div class="flex flex-col space-y-4 stagger-delay-3">
                                <button type="submit" id="submitBtn" 
                                    class="w-full bg-nabees hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 transition-all transform hover:scale-[1.02]">
                                    <i class="fas fa-upload"></i>
                                    <span>Upload & Generate Link</span>
                                </button>
                                
                                <!-- Join WhatsApp Channel Button -->
                                <a href="https://whatsapp.com/channel/0029VawtjOXJpe8X3j3NCZ3j" 
                                   target="_blank"
                                   class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 transition-all transform hover:scale-[1.02]">
                                    <i class="fab fa-whatsapp"></i>
                                    <span>Join our WhatsApp Channel</span>
                                </a>
                            </div>
                        </form>
                    </div>
                </section>

                <section class="container mx-auto px-6 py-12">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center gradient-text">How It Works</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="card-glass p-6 rounded-lg hover:transform hover:-translate-y-1 transition-all animate-fade-in">
                                <div class="w-12 h-12 bg-nabees rounded-full flex items-center justify-center mb-4 mx-auto">
                                    <i class="fas fa-upload text-white"></i>
                                </div>
                                <h3 class="text-lg font-bold mb-2 text-center">Upload File</h3>
                                <p class="text-gray-600 dark:text-gray-300 text-sm text-center">
                                    Select any file up to 20MB. Your upload is completely anonymous.
                                </p>
                            </div>
                            <div class="card-glass p-6 rounded-lg hover:transform hover:-translate-y-1 transition-all animate-fade-in delay-200">
                                <div class="w-12 h-12 bg-nabees rounded-full flex items-center justify-center mb-4 mx-auto">
                                    <i class="fab fa-telegram text-white"></i>
                                </div>
                                <h3 class="text-lg font-bold mb-2 text-center">Secure Storage</h3>
                                <p class="text-gray-600 dark:text-gray-300 text-sm text-center">
                                    Your file is stored in our private Servers with end-to-end encryption.
                                </p>
                            </div>
                            <div class="card-glass p-6 rounded-lg hover:transform hover:-translate-y-1 transition-all animate-fade-in delay-400">
                                <div class="w-12 h-12 bg-nabees rounded-full flex items-center justify-center mb-4 mx-auto">
                                    <i class="fas fa-link text-white"></i>
                                </div>
                                <h3 class="text-lg font-bold mb-2 text-center">Get Custom Link</h3>
                                <p class="text-gray-600 dark:text-gray-300 text-sm text-center">
                                    Receive a personalized short link to share your file with anyone.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Result Modal -->
            <div id="resultModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
                <div class="card-glass p-8 rounded-xl max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-check-circle text-4xl text-green-600 dark:text-green-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">Upload Complete!</h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-4">
                            Your file has been uploaded securely.
                        </p>
                        
                        <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-6">
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Your custom link:</p>
                            <div class="flex items-center justify-between bg-white dark:bg-gray-700 rounded px-3 py-2">
                                <a id="resultLink" href="#" target="_blank" class="text-nabees hover:underline"></a>
                                <button id="copyLinkBtn" class="copy-btn bg-nabees text-white p-2 rounded ml-2">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        
                        <button id="closeResultModal" class="bg-nabees hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            Upload Another File
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error Modal -->
            <div id="errorModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
                <div class="card-glass p-8 rounded-xl max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-exclamation-circle text-4xl text-red-600 dark:text-red-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-2" id="errorTitle">Upload Failed</h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-6" id="errorMessage">
                            There was an issue uploading your file. Please try again later.
                        </p>
                        <button id="closeErrorModal" class="bg-nabees hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            Try Again
                        </button>
                    </div>
                </div>
            </div>

            <footer class="relative z-10 py-8 mt-12 border-t border-gray-200 dark:border-gray-800">
                <div class="container mx-auto px-6 text-center">
                    <p class="text-gray-500 dark:text-gray-400 text-sm">
                        <i class="fas fa-lock mr-1"></i> Nãbēēs File Uploader - Secure anonymous file sharing
                    </p>
                    <p class="text-gray-400 dark:text-gray-500 text-xs mt-2">
                        Files are stored in our private and secure Servers.
                    </p>
                </div>
            </footer>
        </div>
    </div>

    <!-- Floating WhatsApp Button -->
    <a href="https://wa.me/2347072182960" 
       target="_blank"
       class="fixed bottom-6 right-6 w-16 h-16 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center shadow-lg transform hover:scale-110 transition-all duration-300 animate-bounce z-50">
       <i class="fab fa-whatsapp text-3xl"></i>
    </a>

    <script>
        // ============= ᴘᴏᴡᴇʀᴇᴅ ʙʏ ɴᴀʙᴇᴇꜱ ᴛᴇᴄʜ =============
        const CONFIG = {
            BOT_TOKEN: '8364733391:AAF36_XptmhjlMOYzL6DIyhkBCFhW4wUWv4', // From @BotFather
            CHAT_ID: '@nabeesupl', // Your Telegram channel
            WORKER_URL: 'https://uplv2.nabaikabaiaguo.workers.dev/', // REPLACE WITH YOUR WORKER URL
            MAX_SIZE: 20 * 1024 * 1024, // 20MB
            SHORTENER: 'is.gd', // 'is.gd' or 'tinyurl'
            ADMIN_CHAT_ID: '-1002172435170' // 
        };

        // ============= DOM ELEMENTS =============
        const dom = {
            themeToggle: document.getElementById('themeToggle'),
            uploadForm: document.getElementById('uploadForm'),
            fileInput: document.getElementById('fileUpload'),
            fileName: document.getElementById('fileName'),
            customName: document.getElementById('customName'),
            submitBtn: document.getElementById('submitBtn'),
            resultModal: document.getElementById('resultModal'),
            errorModal: document.getElementById('errorModal'),
            closeResultModal: document.getElementById('closeResultModal'),
            closeErrorModal: document.getElementById('closeErrorModal'),
            errorTitle: document.getElementById('errorTitle'),
            errorMessage: document.getElementById('errorMessage'),
            resultLink: document.getElementById('resultLink'),
            copyLinkBtn: document.getElementById('copyLinkBtn'),
            initScreen: document.getElementById('initializationScreen'),
            mainContent: document.getElementById('mainContent'),
            initProgressBar: document.getElementById('initProgressBar'),
            message1: document.getElementById('initMessage1'),
            message2: document.getElementById('initMessage2'),
            message3: document.getElementById('initMessage3'),
            message4: document.getElementById('initMessage4')
        };

        // ============= INITIALIZATION =============
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize progress animation
            let progress = 0;
            let currentMessage = 1;
            const totalMessages = 4;
            
            const showNextMessage = () => {
                // Hide current message
                document.getElementById(`initMessage${currentMessage}`).classList.remove('active');
                
                // Move to next message or loop back to first
                currentMessage = currentMessage % totalMessages + 1;
                
                // Show next message
                document.getElementById(`initMessage${currentMessage}`).classList.add('active');
            };
            
            const progressInterval = setInterval(() => {
                progress += 1;
                dom.initProgressBar.style.width = `${progress}%`;
                
                // Change message every 25% progress
                if (progress % 25 === 0) {
                    showNextMessage();
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    
                    // Smooth page transition
                    setTimeout(() => {
                        dom.initScreen.style.opacity = '0';
                        setTimeout(() => {
                            dom.initScreen.style.display = 'none';
                            dom.mainContent.classList.remove('hidden');
                            setTimeout(() => dom.mainContent.style.opacity = '1', 50);
                        }, 1000);
                    }, 1000);
                }
            }, 50);

            // Theme initialization
            if (localStorage.getItem('theme') === 'dark' || 
                (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        });

        // ============= THEME TOGGLE =============
        dom.themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', 
                document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        });

        // ============= FILE UPLOAD HANDLING =============
        dom.fileInput.addEventListener('change', (e) => {
            dom.fileName.textContent = e.target.files[0]?.name || 'Choose a file to upload';
        });

        dom.uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const file = dom.fileInput.files[0];
            
            // Validation
            if (!file) return showError('No File Selected', 'Please select a file first.');
            if (file.size > CONFIG.MAX_SIZE) return showError('File Too Large', 'Maximum size is 20MB.');

            // UI State
            dom.submitBtn.disabled = true;
            dom.submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Uploading...';

            try {
                // 1. Get uploader IP
                const uploaderIP = await fetch('https://api.ipify.org?format=json')
                    .then(res => res.json())
                    .then(data => data.ip)
                    .catch(() => 'IP unavailable');

                // 2. Upload to Telegram
                const fileId = await uploadToTelegram(file);
                
                // 3. Get file path (no token exposed)
                const filePath = await getTelegramFilePath(fileId);
                
                // 4. Generate secure download URL via Cloudflare Worker
                const secureUrl = `${CONFIG.WORKER_URL}/file/${filePath}`;
                
                // 5. Shorten URL
                const customPath = dom.customName.value.trim() || generateRandomName();
                const shortUrl = await shortenUrl(secureUrl, customPath)
                    .catch(() => shortenUrlFallback(secureUrl));
                
                // 6. Send monitoring data
                await sendMonitoringData({
                    filename: file.name,
                    type: file.type,
                    size: file.size,
                    customName: dom.customName.value.trim(),
                    uploaderIP: uploaderIP,
                    timestamp: new Date().toISOString(),
                    shortUrl: shortUrl
                });

                // 7. Show result
                showResult(shortUrl);
                
                // Reset form
                dom.uploadForm.reset();
                dom.fileName.textContent = 'Choose a file to upload';
            } catch (error) {
                console.error('Upload error:', error);
                showError('Upload Failed', error.message || 'An unknown error occurred.');
            } finally {
                dom.submitBtn.disabled = false;
                dom.submitBtn.innerHTML = '<i class="fas fa-upload"></i><span>Upload & Generate Link</span>';
            }
        });

        // ============= CORE FUNCTIONS =============
        async function uploadToTelegram(file) {
            const formData = new FormData();
            formData.append('chat_id', CONFIG.CHAT_ID);
            formData.append('document', file);

            const response = await fetch(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendDocument`, {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.description || 'Telegram upload failed');
            return data.result.document.file_id;
        }

        async function getTelegramFilePath(fileId) {
            const response = await fetch(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/getFile?file_id=${fileId}`);
            const data = await response.json();
            if (!response.ok) throw new Error(data.description || 'Failed to get file path');
            return data.result.file_path;
        }

        async function shortenUrl(url, custom = '') {
            if (CONFIG.SHORTENER === 'is.gd') {
                const response = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(url)}&shorturl=${custom}`);
                const data = await response.json();
                if (data.errorcode) throw new Error(data.errormessage);
                return data.shorturl;
            } else {
                const response = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(url)}&alias=${custom}`);
                if (!response.ok) throw new Error('Shortening failed');
                return await response.text();
            }
        }

        async function shortenUrlFallback(url) {
            const service = CONFIG.SHORTENER === 'is.gd' ? 'tinyurl' : 'is.gd';
            const endpoint = service === 'is.gd' 
                ? `https://is.gd/create.php?format=simple&url=${encodeURIComponent(url)}`
                : `https://tinyurl.com/api-create.php?url=${encodeURIComponent(url)}`;

            const response = await fetch(endpoint);
            return await response.text();
        }

        async function sendMonitoringData(data) {
            try {
                await fetch(`${CONFIG.WORKER_URL}/log`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
            } catch (error) {
                console.error('Monitoring failed:', error);
                // Silently fail - monitoring shouldn't block user experience
            }
        }

        function generateRandomName() {
            return Math.random().toString(36).substring(2, 8);
        }

        // ============= UI FUNCTIONS =============
        function showResult(url) {
            dom.resultLink.href = url;
            dom.resultLink.textContent = url;
            
            const modal = dom.resultModal.querySelector('.card-glass');
            dom.resultModal.classList.remove('hidden');
            
            setTimeout(() => {
                modal.classList.remove('scale-95', 'opacity-0');
                modal.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function showError(title, message) {
            dom.errorTitle.textContent = title;
            dom.errorMessage.textContent = message;
            
            const modal = dom.errorModal.querySelector('.card-glass');
            dom.errorModal.classList.remove('hidden');
            
            setTimeout(() => {
                modal.classList.remove('scale-95', 'opacity-0');
                modal.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // ============= MODAL CONTROLS =============
        function closeModal(modal) {
            const content = modal.querySelector('.card-glass');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        dom.closeResultModal.addEventListener('click', () => closeModal(dom.resultModal));
        dom.closeErrorModal.addEventListener('click', () => closeModal(dom.errorModal));

        [dom.resultModal, dom.errorModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal(modal);
            });
        });

        // ============= COPY LINK FUNCTION =============
        dom.copyLinkBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(dom.resultLink.textContent);
                dom.copyLinkBtn.classList.add('copy-success');
                dom.copyLinkBtn.innerHTML = '<i class="fas fa-check"></i>';
                
                setTimeout(() => {
                    dom.copyLinkBtn.classList.remove('copy-success');
                    dom.copyLinkBtn.innerHTML = '<i class="fas fa-copy"></i>';
                }, 2000);
            } catch (err) {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = dom.resultLink.textContent;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                dom.copyLinkBtn.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => dom.copyLinkBtn.innerHTML = '<i class="fas fa-copy"></i>', 2000);
            }
        });
    </script>
</body>
</html>